---
layout: post
title: "Mybatis 复习（一）"
categories:
- java
---

### 学习资料： ###

1. [课程学习资源下载](http://pan.baidu.com/s/1o7BoTOu) &emsp;&emsp;密码：f91l
2. [官方文档中文](http://www.mybatis.org/mybatis-3/zh/index.html)&emsp;&emsp;[官方文档英文](http://www.mybatis.org/mybatis-3/) &emsp;&emsp;[Mybatis-Github(含有最新下载链接)](https://github.com/mybatis/mybatis-3/)
3. [书籍资料](http://pan.baidu.com/s/1jHH2DAu)&emsp;&emsp; 密码：l9zk
4. [学习笔记](http://pan.baidu.com/s/1c1XnVTe)&emsp;&emsp; 密码：7p6t
### 目录结构： ###

1. <a href="#1">**JDBC带来的问题**</a>
2. <a href="#2">**Mybatis架构**</a>
3. <a href="#3">**项目搭建**</a>
	1. <a href="#33">**sqlMapperConfig.xml**</a>


--------

## <a name="1">1.JDBC带来的问题</a> ##


1. ### 存在的问题 ###
	1. 数据库connetion频繁连接的释放，影响系统性能。（DBCP可以从DataSource获得链接）
	2. sql语句编写在java代码中，修改sql语句要重新编译java
	3. preparedStatement中设置参数，占位符号位置和设置参数值，硬编码在java代码中，不利于系统维护。
	4. 从resutSet中遍历、构建对象，需要程序员编写映射关系。（jdbcTemple可以简化映射关系）

1. ### <font color="red">实现代码</font> ( 加载驱动的方式有三种 )  ###

		Public static void main(String[] args) {
					Connection connection = null;
					PreparedStatement preparedStatement = null;
					ResultSet resultSet = null;
					try {
		// 加载数据库驱动
						Class.forName("com.mysql.jdbc.Driver");
		// DriverManager.registerDriver(com.mysql.jdbc.Driver);
		// System.setProperty(“jdbc.drivers”, “driver1:driver2”);
		// 通过驱动管理类获取数据库链接
						connection =  DriverManager.getConnection("jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8", "root", "mysql");
		// 定义sql语句 ?表示占位符
						String sql = "select * from user where username = ?";
		// 获取预处理statement
						preparedStatement = connection.prepareStatement(sql);
		// 设置参数，第一个参数为sql语句中参数的序号（从1开始），第二个参数为设置的参数值
						preparedStatement.setString(1, "王五");
		// 向数据库发出sql执行查询，查询出结果集
						resultSet =  preparedStatement.executeQuery();
		// 遍历查询结果集
						while(resultSet.next()){
							System.out.println(resultSet.getString("id")+"  "+resultSet.getString("username"));
						}
					} catch (Exception e) {
						e.printStackTrace();
					}finally{
		// 释放资源
						if(resultSet!=null){
							try {
								resultSet.close();
							} catch (SQLException e) {
								// TODO Auto-generated catch block
								e.printStackTrace();
							}
						}
						if(preparedStatement!=null){
							try {
								preparedStatement.close();
							} catch (SQLException e) {
								// TODO Auto-generated catch block
								e.printStackTrace();
							}
						}
						if(connection!=null){
							try {
								connection.close();
							} catch (SQLException e) {
								// TODO Auto-generated catch block
								e.printStackTrace();
							}
						}
		
					}
		
				}

-----
## <a name="2">2.Mybatis架构</a> ##
<br/>![](img/2016-08-03-m-1.png)

## <a name="3">3.项目搭建</a> ##
1. [Jar包和source文件](http://pan.baidu.com/s/1skC4Gkl)&emsp;&emsp;密码：8hww
2. log4j.properties

		# Global logging configuration
		log4j.rootLogger=DEBUG, stdout
		# Console output...
		log4j.appender.stdout=org.apache.log4j.ConsoleAppender
		log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
		log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n
2. <a name="33">sqlMapperConfig.xm</a>
	1. 文件结构

			properties（属性）
			settings（全局配置参数）
			typeAliases（类型别名）
			typeHandlers（类型处理器）
			objectFactory（对象工厂）
			plugins（插件）
			environments（环境集合属性对象）
				environment（环境子属性对象）
					transactionManager（事务管理）
						dataSource（数据源）
			mappers（映射器）
	2. 基础实例
	
			<?xml version="1.0" encoding="UTF-8" ?>
			<!DOCTYPE configuration
			PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
			"http://mybatis.org/dtd/mybatis-3-config.dtd">
			<configuration>
				<environments default="development">
					<environment id="development">
					<!-- 使用jdbc事务管理-->
						<transactionManager type="@@JDBC" />
					<!-- 数据库连接池-->
						<dataSource type="@@POOLED">
							<property name="driver" value="com.mysql.jdbc.Driver" />
							<property name="url" value="jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8" />
							<property name="username" value="@@root" />
							<property name="password" value="@@mysql" />
						</dataSource>
					</environment>
				</environments>
				<mappers>
					<mapper resource="@@sqlmap/User.xml"/>
				</mappers>
			</configuration>
	2. properties（属性）<br/>
使用外部的properties文件作为sqlMapperConfig.xml的引用属性
		1. db.properties文件配置
		
				jdbc.driver=com.mysql.jdbc.Driver
				jdbc.url=jdbc:mysql://localhost:3306/mybatis
				jdbc.username=root
				jdbc.password=mysql
		2. sqlMapperConfig.xml的配置

				<properties resource="db.properties"/>

					<environments default="development">
						<environment id="development">
							<transactionManager type="JDBC"/>
							<dataSource type="POOLED">
								<property name="driver" value="${jdbc.driver}"/>
								<property name="url" value="${jdbc.url}"/>
								<property name="username" value="${jdbc.username}"/>
								<property name="password" value="${jdbc.password}"/>
							</dataSource>
						</environment>
					</environments>
		2. 在sqlMapperConfig.xml使用这些属性要注意：`${jdbc.username}`获得属性值
		3. [settings（全局配置参数），将会影响mybatis的运行行为](http://www.mybatis.org/mybatis-3/zh/configuration.html#settings)
		4. typeAliases（类型别名）
			1. [mybatis默认别名](http://www.mybatis.org/mybatis-3/zh/configuration.html#typeAliases)
			2. 自定义别名

				<typeAliases>
					<!-- 单个别名定义 -->
					<typeAlias alias="user" type="cn.itcast.mybatis.po.User" />
					<!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） -->
					<package name="cn.itcast.mybatis.po" />
				</typeAliases>
		5. 

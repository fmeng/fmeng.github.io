---
layout: post
title: "发送HTTP和HTTPS报文--预备知识"
categories:
- java
---

&emsp;&emsp;写一些小爬虫，给Http协议打交道是难免的。抓取别人的网页说白了，也就是模拟发送http的报文，然后对得到的结果处理。这里简单介绍几个必须了解的概念，关于协议之类的细节，你可以自行学习。这里推荐只几本书和一些学习资料。

教学视频（自己学院录得视频感觉比较好）<br/>
[http://sharecourse.upln.cn/pdt/sharecourse/modules/mod_course/app/course.php?cid=47c6381b-3aae-4cf6-a4f9-1cf6d28bf179](http://sharecourse.upln.cn/pdt/sharecourse/modules/mod_course/app/course.php?cid=47c6381b-3aae-4cf6-a4f9-1cf6d28bf179)<br/>
推荐书籍<br/>
《计算机网络（第六版）》 谢希仁 编著 &emsp;&emsp;&emsp;[点击下载PDF和课件](http://pan.baidu.com/s/1bnhGF3T)&emsp;密码：e7u5<br/>
>这本书是我接触网络的入门书。书写的比较容易易懂，如果你没有接触过网络，就从这本书开始吧。

《TCP-IP详解卷一：协议》&emsp;&emsp;&emsp;&emsp;[下载PDF](http://pan.baidu.com/s/1bnaVd63)&emsp;密码：fb4v<br/>
>这本书写的比较早，现在又很多标准已经改变了。“尽信书，不如无书”，学会在看书的时候思考。

《HTTP权威指南》&emsp;&emsp;&emsp;&emsp;[下载PDF](http://pan.baidu.com/s/1c06bk7Q)&emsp;密码：0f1i
>这本书，我看了不少于3遍。一边看书，一边做笔记，一边思考。这本书细致讲解了HTTP协议的细节，我觉得只要你做网站开发（无论何种语言，无论前端后还是后台），细读此书，你会有不一样的收获。

**&emsp;&emsp;虽然，网络是开放的，随时可以下到书籍资料。但是，我觉得还是应该买本书看看。那样，才有感觉。不缺这几个钱，对吗？**

#### 说几个概念 ####

1. HTTP协议是基于**字符**的。<br/>
&emsp;&emsp;**TCP/IP协议中，数据链路层是基于字节的，网络层是基于报文的**。首先，“基于”这个词，应该揣摩一下。意思就是，站在人的角度能分析理解的意思。也就是，数据链路层，我们只能看到些01的代码。网络层，可以看到报文和报文的组织结构。HTTP协议，我们能看到字符（例如 get /index.html http1.0）这些字符，都是我们能够理解的。这一点，如果理解还是不够透彻的话，试着用wireshark抓包分析一下，一切都明了了。<br/>
&emsp;&emsp;HTTP协议基于字符的设计，是设计为了程序开发人员故意设计成字符可见的。意在，方便开发者应用，降低学习成本（这一点还是比较赞的）。
2. 连接控制<br/>
&emsp;&emsp;在HTTP1.0的时候，使用**短连接**。也就是说，当用户请求10小图片的时候，每次请求一张图片都要先建立连接和释放连接。也就是，TCP建立连接的3次握手和4次放手。试想，如果文件很小，但是在数据传输的过程中还是需要必要的报文的头部和尾部的封装的。这样一来，报文传输的数据效率就大大减小了。在HTTP1.1的时候，为了提高文件传输过程中报文的利用效率。我们使用了**长连接**和并**发连接**的方式解决文件在传输过程中的效率问题。具体关于连接控制的内容可以参考上面推荐的几本书。
3. 会话控制<br/>
&emsp;&emsp;写过一点网站后台脚本的都知道，会话控制是整个网站搭建的灵魂（就我了解）。会话控制**就是服务器，动态识别，不同的和服务器交互的客户端的上下文状态。**说白了，就是**服务器如何识别本次访问服务器的客户端，以前有没有访问过服务器，如果访问过了服务器，它在服务器上做了什么，保存了那些状态。**这些才是理解会话控制的关键。
4. 编码<br/>
&emsp;&emsp;无论是在导入新的jar包，抓包分析报文，连接数据库等过程中都是会遇到乱码问题的。有时候，我们可以轻而易举的通过google找到乱码的解决方案，然后欣喜若狂的继续写代码。但是有的时候，乱码问题是一些连带性的问题，通过简单的google是很难解决的。所以，我们必须要有自己的一套解决方案。
	1. 分析<br/>&emsp;&emsp;就像治病一样，我们首先要找到病因。这一步是最难的也是最重要的。例如，在解析html文件标签的时候出现了乱码。我们要一点一点的测试，是不是我们抓取的报文编码有问题，是不是导入的第三方jar包不支持该种文件的编码格式……逐步细化问题，找到问题的症结。
	2. 测试<br/>&emsp;&emsp;这一步应该是和分析那一步结合在一起的。找到问题可能出现的地方，就开始测试。
	3. 模型化
	4. 总结


#### HTTPS ####
&emsp;&emsp;起初，在抓取HTTPS协议的报文的时候，一直没有成功。其关键原因是在于我对HTTPS协议报文的发送过程不是很理解。只能后来，在狂补HTTPS相关的知识。关于HTTPS相关的内容《HTTP 权威指南》这本书写的比较好，我这里也就不啰嗦了。

#### 最后 ####
&emsp;&emsp;这一段应该是强迫症患者必写的内容。在模拟浏览器爬去服务器网站信息的过程中，我们可能会遇到很多问题。关键是我们要找到一套适合自己的好方法，这样解决问题就会省不少心。**你要知道，办法总要比问题多！**
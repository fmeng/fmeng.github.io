---
layout: post
title: "Mybatis 复习（二）"
categories:
- java
---
### 学习资料： ###
1. [课程学习资源下载](http://pan.baidu.com/s/1o7BoTOu) &emsp;&emsp;密码：f91l
2. [官方文档中文](http://www.mybatis.org/mybatis-3/zh/index.html)&emsp;&emsp;[官方文档英文](http://www.mybatis.org/mybatis-3/) &emsp;&emsp;[Mybatis-Github(含有最新下载链接)](https://github.com/mybatis/mybatis-3/)
3. [Mybatis API](http://www.mybatis.org/mybatis-3/apidocs/reference/org/apache/ibatis/session/SqlSession.html)
3. [书籍资料](http://pan.baidu.com/s/1jHH2DAu)&emsp;&emsp; 密码：l9zk
4. [学习笔记](http://pan.baidu.com/s/1mhSoiSC)&emsp;&emsp; 密码：i9ie

--------
### <a>目录</a> ###

1. <a href="#1">一对一查询</a>
	1. <a href="#11">通过resultetype映射查询结果</a>
	2. <a href="#12">通过resultMap映射查询结果</a>
	3. <a href="#13">resulteType和resultMap对比</a>
2. <a href="#2">一对多查询</a>
	1. <a href="#21">OrdersAndOrderDetailResultMap定义</a>
3. <a href="#3">多对多查询</a>
4. <a href="#4">条件查询总结</a>
	1. <a href="#41">resultType</a>
	2. <a href="#42">resultMap</a>
	3. <a href="#43">association</a>
	4. <a href="#44">collection</a>


------

![](/img/database-mybatis.bmp)


### <a name="1">1. 一对一查询</a> ###

1. <a name="11">通过resultetype映射查询结果</a>

	OrdersMapperCustom.java (Mapper.java)
		
		// 查询订单关联查询用户信息
		public List<OrdersCustom> findOrdersUser()throws Exception;	
	
	<font style="color:red">OrdersCustom.java（pojo）</font>
	
		public class OrdersCustom extends Orders{
			// 在继承Orders的基础上，添加了User的属性
			private String username;
			private String sex;
			private String address;
		}
	
	
	SQL（statement）
	
		<select id="findOrdersUser" resultType="cn.itcast.mybatis.po.OrdersCustom">
			SELECT
			orders.*,
			USER.username,
			USER.sex,
			USER.address
			FROM
			orders,
			USER
			WHERE orders.user_id = user.id
		</select>
2. <a name="12">通过resultMap映射查询结果</a>

	OrdersMapperCustom.java (Mapper.java)
	
		// 查询订单关联查询用户信息
		public List<OrdersCustom> findOrdersUser()throws Exception;	

	<font color="red">Orders.java</font>	

		public class Orders {
			// 没有添加user的属性，是直接把user引用过来了
		    private Integer id;
		    private Integer userId;
		    private String number;
		    private Date createtime;
		    private String note;
		    //用户信息
		    private User user;
		}
	

	SQL（和resultType的sql语句相同）

	<font color="red">
	resultMap定义</font>

		<resultMap type="cn.itcast.mybatis.po.Orders" id="OrdersUserResultMap">
			<!-- 1. 配置映射的订单信息------------------------------- -->
			<!-- 
				id：      如果有多个列组成唯一标识，配置多个id，列中的唯一标识
				column：  sql输出结果的列
				property：bean的属性
			  -->
			<id column="id" property="id"/>
			<result column="user_id" property="userId"/>
			<result column="number" property="number"/>
			<result column="createtime" property="createtime"/>
			<result column="note" property="note"/>
			
			<!-- 2. 配置映射的关联的用户信息-------------------------- -->
			<!-- 
				association：用于映射关联查询单个对象的信息
				property：   要将关联查询的用户信息映射到Orders中哪个属性
				javaType：   映射到user的哪个属性
			 -->
			<association property="user"  javaType="cn.itcast.mybatis.po.User">
				<id column="user_id" property="id"/>
				<result column="username" property="username"/>
				<result column="sex" property="sex"/>
				<result column="address" property="address"/>
			</association>
		</resultMap>
	

3. <a name="13">resulteType和resultMap对比</a>
	1. resultType：<font color="red">增加列名对应的属性（`user.username`,`user.sex`,`user.address`）</font>，完成映射
	2. resultMap： <font color="red">通过包含这些属性的对象（`user`）</font>,增加列名对应的属性
	3. resultMap： 可以实现延迟加载，resultType无法实现延迟加载

### <a name="2">2. 一对多查询</a> ###

OrdersMapperCustom.java (Mapper.java)

	//查询订单关联查询用户使用resultMap
	public List<Orders> findOrdersUserResultMap()throws Exception;

Orders.java（pojo）

	public class Orders {
	    private Integer id;
	    private Integer userId;
	    private String number;
	    private Date createtime;
	    private String note; 
	    //用户信息
	    private User user;
	    //订单明细 list
	    private List<Orderdetail> orderdetails;
	}

<a name="21"><font color="red">OrdersAndOrderDetailResultMap定义</font></a>



	<resultMap id="OrdersAndOrderDetailResultMap"
			   type="cn.itcast.mybatis.po.Orders"
		       extends="OrdersUserResultMap">
		<!-- 
			1. 订单信息、用户信息
				通过extends获得，不用在中配置订单信息和用户信息的映射
		-->
		<!-- 
			2. 订单明细信息
				每个订单的多个订单详情orderdetail要使用collection进行映射
				collection：对关联查询到多条记录映射到集合对象中
				property：映射orders对象的哪个属性
				ofType：list中pojo的类型
		 -->
		 <collection property="orderdetails" ofType="cn.itcast.mybatis.po.Orderdetail">
		 	<!-- 
				id：      订单明细唯一标识
			 	property: 将行信息映射到(list<Orderdetail>)中的对象(Orderdetail)的哪个属性
		 	  -->
		 	<id column="orderdetail_id" property="id"/>
		 	<result column="items_id" property="itemsId"/>
		 	<result column="items_num" property="itemsNum"/>
		 	<result column="orders_id" property="ordersId"/>
		 </collection>
	</resultMap>



OrdersUserResultMap 定义（被扩展）

	<resultMap type="cn.itcast.mybatis.po.Orders" id="OrdersUserResultMap">
		<!-- 1. 配置映射的订单信息------------------------------- -->
		<!-- 
			id：      如果有多个列组成唯一标识，配置多个id，列中的唯一标识
			column：  sql输出结果的列
			property：bean的属性
		  -->
		<id column="id" property="id"/>
		<result column="user_id" property="userId"/>
		<result column="number" property="number"/>
		<result column="createtime" property="createtime"/>
		<result column="note" property="note"/>
		
		<!-- 2. 配置映射的关联的用户信息-------------------------- -->
		<!-- 
			association：用于映射关联查询单个对象的信息
			property：   要将关联查询的用户信息映射到Orders中哪个属性
			javaType：   映射到user的哪个属性
		 -->
		<association property="user"  javaType="cn.itcast.mybatis.po.User">
			<id column="user_id" property="id"/>
			<result column="username" property="username"/>
			<result column="sex" property="sex"/>
			<result column="address" property="address"/>
		</association>
	</resultMap>


### <a name="3">3. 多对多查询</a> ###

<font color="red">OrdersMapperCustom.java (Mapper.java)</font>



	//查询用户购买商品信息, 注意多对多映射的结果为List<User>
	public List<User>  findUserAndItemsResultMap()throws Exception;



Orders.java（pojo）

	public class Orders {
	    private Integer id;
	    private Integer userId;
	    private String number;
	    private Date createtime;
	    private String note; 
	    //用户信息
	    private User user;
	    //订单明细 list
	    private List<Orderdetail> orderdetails;
	}

UserAndItemsResultMap(配置)

	<resultMap type="cn.itcast.mybatis.po.User" id="UserAndItemsResultMap">
		
		<!-- 用户信息 -->
		<id column="user_id" property="id"/>
		<result column="username" property="username"/>
		<result column="sex" property="sex"/>
		<result column="address" property="address"/>
		
		<!-- 订单信息，一个用户对应多个订单，使用collection映射 -->
		 <collection property="ordersList" ofType="cn.itcast.mybatis.po.Orders">
		 	<id column="id" property="id"/>
		 	<result column="user_id" property="userId"/>
			<result column="number" property="number"/>
			<result column="createtime" property="createtime"/>
			<result column="note" property="note"/>

			 <!-- 订单明细，一个订单包括多个明细 -->
		  	<collection property="orderdetails" ofType="cn.itcast.mybatis.po.Orderdetail">
		  			<id column="orderdetail_id" property="id"/>
				 	<result column="items_id" property="itemsId"/>
				 	<result column="items_num" property="itemsNum"/>
				 	<result column="orders_id" property="ordersId"/>

				 	<!-- 商品信息一个订单明细对应一个商品 -->
			  	 	<association property="items" javaType="cn.itcast.mybatis.po.Items">
			  	 		<id column="items_id" property="id"/>
			  	 		<result column="items_name" property="name"/>
			  	 		<result column="items_detail" property="detail"/>
			  	 		<result column="items_price" property="price"/>
			  	 	</association>	
		  	</collection>
		 </collection>
	</resultMap>

### <a name="4">4. 条件查询总结：</a> ###
1. <a name="41">resultType</a>：将查询结果按照sql列名pojo属性名一致性映射到pojo中
2. <a name="42">resultMap</a>：使用association和collection完成一对一和一对多高级映射
	1. <a name="43">association</a>：将关联查询信息映射到一个pojo对象中
		
		1.  <font color="red">association：用于映射关联查询单个对象的信息</font>
		2.  <font color="red">property：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;要将关联查询的用户信息映射到Orders中哪个属性</font>
		3.  <font color="red">javaType：&nbsp;&nbsp;&nbsp;&nbsp;映射到user的哪个属性</font>
					
			    <association property="user"  javaType="cn.itcast.mybatis.po.User">
			        <id column="user_id" property="id"/>
			        <result column="username" property="username"/>
			        <result column="sex" property="sex"/>
			        <result column="address" property="address"/>
			    </association>
			>使用resultType无法将查询结果映射到pojo对象的pojo属性中

	2. <a name="44">collection</a>：将关联查询信息映射到一个list集合中
		1. <font color="red">id：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;订单明细唯一标识</font>
        2. <font color="red">property: 将行信息映射到(list<Orderdetail>)中的对象(Orderdetail)的哪个属性</font>
        
			 	<collection property="orderdetails" ofType="cn.itcast.mybatis.po.Orderdetail">
			        <id column="orderdetail_id" property="id"/>
			        <result column="items_id" property="itemsId"/>
			        <result column="items_num" property="itemsNum"/>
			        <result column="orders_id" property="ordersId"/>
			     </collection>



-----

5. 延迟加载

7. 查询缓存

8. spring和mybatis整合

9. 逆向工程

